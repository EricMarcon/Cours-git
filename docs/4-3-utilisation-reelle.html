<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="french" xml:lang="french">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Contrôle de source avec git" />
<meta property="og:type" content="book" />








<meta name="description" content="Contrôle de source avec git">

<title>Contrôle de source avec git</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>

<style type="text/css">
  p.abstract{
    text-align: center;
    font-weight: bold;
  }
  div.abstract{
    margin: auto;
    width: 90%;
  }
</style>

<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="1-introduction.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="2-installation.html#installation"><span class="toc-section-number">2</span> Installation</a></li>
<li class="has-sub"><a href="3-projet-r-sous-controle-de-source.html#projet-r-sous-controle-de-source"><span class="toc-section-number">3</span> Projet R sous contrôle de source</a><ul>
<li><a href="3-1-principes.html#principes"><span class="toc-section-number">3.1</span> Principes</a></li>
<li><a href="3-2-commencer.html#commencer"><span class="toc-section-number">3.2</span> Commencer</a></li>
<li><a href="3-3-gitignore.html#gitignore"><span class="toc-section-number">3.3</span> .gitignore</a></li>
</ul></li>
<li class="has-sub"><a href="4-donnees-confidentielles-dans-un-depot-public.html#donnees-confidentielles-dans-un-depot-public"><span class="toc-section-number">4</span> Données confidentielles dans un dépôt public</a><ul>
<li class="has-sub"><a href="4-1-prealables.html#prealables"><span class="toc-section-number">4.1</span> Préalables</a><ul>
<li><a href="4-1-prealables.html#generation-dune-paire-de-cles"><span class="toc-section-number">4.1.1</span> Génération d’une paire de clés</a></li>
<li><a href="4-1-prealables.html#copie-de-la-cle-publique-sur-github"><span class="toc-section-number">4.1.2</span> Copie de la clé publique sur GitHub</a></li>
</ul></li>
<li class="has-sub"><a href="4-2-utilisation-dun-coffre-fort.html#utilisation-dun-coffre-fort"><span class="toc-section-number">4.2</span> Utilisation d’un coffre-fort</a><ul>
<li><a href="4-2-utilisation-dun-coffre-fort.html#creation-dun-coffre-fort"><span class="toc-section-number">4.2.1</span> Création d’un coffre-fort</a></li>
<li><a href="4-2-utilisation-dun-coffre-fort.html#ajout-dutilisateurs"><span class="toc-section-number">4.2.2</span> Ajout d’utilisateurs</a></li>
<li><a href="4-2-utilisation-dun-coffre-fort.html#ajout-de-donnees"><span class="toc-section-number">4.2.3</span> Ajout de données</a></li>
<li><a href="4-2-utilisation-dun-coffre-fort.html#liste-des-secrets"><span class="toc-section-number">4.2.4</span> Liste des secrets</a></li>
<li><a href="4-2-utilisation-dun-coffre-fort.html#decryptage"><span class="toc-section-number">4.2.5</span> Décryptage</a></li>
</ul></li>
<li><a href="4-3-utilisation-reelle.html#utilisation-reelle"><span class="toc-section-number">4.3</span> Utilisation réelle</a></li>
<li><a href="4-4-partage-du-secret.html#partage-du-secret"><span class="toc-section-number">4.4</span> Partage du secret</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="utilisation-reelle" class="section level2">
<h2><span class="header-section-number">4.3</span> Utilisation réelle</h2>
<p>Le propriétaire du projet contenant les données confidentielles crée un coffre-fort et y stocke les données avant de pousser le projet sur <em>GitHub</em>.</p>
<p>Le décryptage des données nécessite une clé privée. Les clés privées des utilisateurs doivent impérativement être protégées par mot de passe : l’accès au fichier par un tiers est toujours possible sur le disque dur ou dans le cadre d’une sauvegarde. L’exécution du code R en mode non-interactif (le tricotage d’un fichier Rmarkdown par exemple) ne permet pas la saisie de ce mot de passe. La bonne pratique consiste à créer une paire de clé spécifique à chaque projet dont la clé privée, non protégée par mot de passe, ne sera pas stockée sur GitHub. La clé privée non protégée permet de tricoter le fichier sur le poste de travail du propriétaire du projet. Elle peut être distribuée aux utilisateurs ayant besoin de reproduire l’exécution du code (par exemple une salle de classe), ce qui est plus simple que l’ajout de chaque utilisateur dans le coffre-fort. Elle est vulnérable : elle peut par exemple être diffusée par un étudiant, mais les conséquences d’une compromission de la clé sont limitées au décodage des données du projet. Il suffit de retirer l’utilisateur correspondant du coffre-fort et de régénérer une nouvelle paire de clés pour sécuriser à nouveau le projet.</p>
<p>La création de la clé du projet a lieu dans <em>Git Bash</em> avec la commande <code>ssh-keygen -t rsa -b 4096</code>. Spécifier le chemin du fichier : il doit être placé dans le dossier du projet son nom doit être celui du projet RStudio suffixé par <code>_rsa</code> (exemple : <code>Cours-git_rsa</code>). Ne pas saisir de mot de passe. Ajouter une ligne <code>*_rsa</code> dans le fichier <code>.gitignore</code> pour ne pas stocker la clé privée sur dans le dépôt git.</p>
<p>La clé publique est ajoutée à la liste des utilisateurs du coffre-fort et les secrets sont partagés.</p>
<p>Le script suivant permet de créer un coffre-fort dont les données sont lisibles avec la clé privée du projet.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;secret&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;openssl&quot;</span>)
<span class="co"># Création du coffre-fort</span>
vault2 &lt;-<span class="st"> &quot;vault2&quot;</span>
<span class="kw">create_vault</span>(vault2)
<span class="co"># Utilisateur correspondant au projet</span>
ClePubliqueDuProjet &lt;-<span class="st"> </span><span class="kw">read_pubkey</span>(<span class="st">&quot;Cours-git_rsa.pub&quot;</span>)
<span class="kw">add_user</span>(<span class="st">&quot;Cours-git&quot;</span>, <span class="dt">public_key =</span> ClePubliqueDuProjet, 
    <span class="dt">vault =</span> vault2)
<span class="co"># Propriétaire du projet</span>
<span class="kw">add_github_user</span>(<span class="st">&quot;EricMarcon&quot;</span>, <span class="dt">vault =</span> vault2)
<span class="co"># Données</span>
MySecret &lt;-<span class="st"> &quot;Texte secret 2&quot;</span>
<span class="co"># Création du secret, avec deux utilisateurs : le</span>
<span class="co"># propriétaire du projet et l&#39;utilisateur</span>
<span class="co"># correspondant au projet</span>
<span class="kw">add_secret</span>(<span class="st">&quot;MonSecret&quot;</span>, <span class="dt">value =</span> MySecret, <span class="dt">users =</span> <span class="kw">c</span>(<span class="st">&quot;github-EricMarcon&quot;</span>, 
    <span class="st">&quot;Cours-git&quot;</span>), <span class="dt">vault =</span> vault2)
<span class="co"># Vérification</span>
<span class="kw">list_owners</span>(<span class="st">&quot;MonSecret&quot;</span>, <span class="dt">vault =</span> vault2)</code></pre></div>
<pre><code>## [1] &quot;Cours-git&quot;         &quot;github-EricMarcon&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Décryptage, sans interaction</span>
<span class="kw">get_secret</span>(<span class="st">&quot;MonSecret&quot;</span>, <span class="dt">key =</span> <span class="kw">read_key</span>(<span class="st">&quot;Cours-git_rsa&quot;</span>), 
    <span class="dt">vault =</span> vault2)</code></pre></div>
<pre><code>## [1] &quot;Texte secret 2&quot;</code></pre>
<p>Le secret peut être lu avec la clé du projet, qui ne nécessite pas d’interaction.</p>
</div>
<p style="text-align: center;">
<a href="4-2-utilisation-dun-coffre-fort.html"><button class="btn btn-default">Previous</button></a>
<a href="4-4-partage-du-secret.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
